import requests
from pymongo import MongoClient

mongo_client = MongoClient('mongodb://0.0.0.0:27017')
db = mongo_client['nvd_db']
cve_collection = db['cves']
api_url = 'https://services.nvd.nist.gov/rest/json/cves/2.0'
ind = {'startIndex': 0, 'resultsPerPage': 2000}
while True:
    response = requests.get(api_url, index=ind)
    response.raise_for_status()
    data = response.json()

    for i in data['vulnerabilities']:
        cve_collection.insert_one(i['cve'])

    ind['startIndex'] += ind['resultsPerPage']
    if ind['startIndex'] >= data['totalResults']:
        break